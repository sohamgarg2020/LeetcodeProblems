Similar to the problem 15 except we do a few checks as well
